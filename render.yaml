# Render Blueprint: Drupal 11 (Storyfulls) + MySQL
# Deploy from repo root; creates:
# - Private MySQL 8 service (with persistent disk)
# - Drupal web service (Docker)
#
# See RENDER_DEPLOY.md for step-by-step instructions, including importing your DB/files.

services:
  # MySQL database (private service, internal-only)
  - type: pserv
    name: storyfulls-mysql
    runtime: image
    image:
      url: mysql:8.0
    envVars:
      - key: MYSQL_DATABASE
        value: storyfulls
      - key: MYSQL_USER
        value: storyfulls
      - key: MYSQL_PASSWORD
        sync: false
      - key: MYSQL_ROOT_PASSWORD
        generateValue: true
    disk:
      name: mysql-data
      mountPath: /var/lib/mysql
      sizeGB: 10

  # Drupal web service
  - type: web
    name: storyfulls
    runtime: docker
    plan: free
    region: oregon
    envVars:
      - key: DB_HOST
        fromService:
          name: storyfulls-mysql
          type: pserv
          property: host
      - key: DB_PORT
        value: "3306"
      - key: DB_NAME
        value: storyfulls
      - key: DB_USER
        value: storyfulls
      - key: DB_PASS
        fromService:
          name: storyfulls-mysql
          type: pserv
          envVarKey: MYSQL_PASSWORD
      - key: DRUPAL_HASH_SALT
        generateValue: true
      # Optional: set after first deploy to fix mixed content (use your Render URL)
      # - key: DRUPAL_BASE_URL
      #   value: https://storyfulls.onrender.com
    disk:
      name: drupal-files
      mountPath: /var/www/html/web/sites/default/files
      sizeGB: 5
    healthCheckPath: /
