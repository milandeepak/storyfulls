{#
/**
 * @file
 * Theme override for book nodes in full display mode.
 */
#}
{{ attach_library('storyfulls/global-styling') }}
<article{{ attributes.addClass('book-detail-page') }}>
  
  {# Page Title #}
  <div class="book-detail-header">
    <h1{{ title_attributes.addClass('book-detail-title') }}>{{ label }}</h1>
  </div>

  {# Main Content Area #}
  <div class="book-detail-content">
    
    {# Left Column - Book Cover #}
    <div class="book-cover-column">
      {% if has_cover and cover_url %}
        <img src="{{ cover_url }}" alt="{{ label }}" class="book-cover-image">
      {% else %}
        <div class="book-cover-placeholder">
          <p>Book cover not uploaded yet</p>
        </div>
      {% endif %}
      
      {# Rating Badge on Book Cover #}
      {% if rating_count > 0 %}
        <div class="book-rating-badge">
          <span class="rating-star-icon">â˜…</span>
          <span class="rating-value">{{ average_rating|number_format(1) }}</span>
        </div>
      {% endif %}
    </div>

    {# Middle Column - Description #}
    <div class="book-description-column">
      <h2 class="section-label">Description</h2>
      {% if description %}
        <div class="book-description">
          {{ description|raw|nl2br }}
        </div>
      {% else %}
        <p class="no-description">No description available for this book.</p>
      {% endif %}

      {# Buy on Amazon and Share Buttons #}
      <div class="book-action-buttons">
        {% if purchase_url %}
          <a href="{{ purchase_url }}" target="_blank" rel="noopener" class="buy-amazon-btn">
            <span class="btn-text">{{ purchase_title }}</span>
            <span class="btn-icon">ðŸ›’</span>
          </a>
        {% endif %}
        <button class="share-btn" onclick="shareBook()" title="Share this book">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z" fill="currentColor"/>
          </svg>
        </button>
      </div>
    </div>

    {# Right Column - Action Buttons #}
    <div class="book-actions-column">
      <button class="action-btn read-later-btn" data-book-id="{{ node.id() }}"
        {% if in_wishlist or in_books_read or user_already_reviewed %}disabled{% endif %}
        {% if in_wishlist %}data-reason="already-in-wishlist"{% endif %}
        {% if in_books_read %}data-reason="already-read"{% endif %}
        {% if user_already_reviewed %}data-reason="already-reviewed"{% endif %}>
        <span class="btn-icon-circle">
          <img src="/themes/custom/storyfulls/images/readlatericon.png" alt="Read Later" class="btn-icon-img">
        </span>
        <span class="btn-text">
          {% if in_wishlist %}
            Already in Read Later
          {% else %}
            Read Later
          {% endif %}
        </span>
      </button>
      <button class="action-btn already-read-btn" data-book-id="{{ node.id() }}"
        {% if in_wishlist or in_books_read or user_already_reviewed %}disabled{% endif %}
        {% if in_wishlist %}data-reason="in-wishlist"{% endif %}
        {% if in_books_read %}data-reason="already-in-list"{% endif %}
        {% if user_already_reviewed %}data-reason="already-reviewed"{% endif %}>
        <span class="btn-icon-circle">
          <img src="/themes/custom/storyfulls/images/alreadyreadicon.png" alt="Already Read" class="btn-icon-img">
        </span>
        <span class="btn-text">
          {% if in_books_read %}
            Already Marked as Read
          {% elseif in_wishlist %}
            In Read Later List
          {% elseif user_already_reviewed %}
            Already Reviewed
          {% else %}
            Already Read
          {% endif %}
        </span>
      </button>
      <a href="/books" class="action-btn books-btn">
        <span class="btn-icon-circle">
          <img src="/themes/custom/storyfulls/images/inclusivity-books-icon.png" alt="More Inclusivity Books" class="btn-icon-img">
        </span>
        <span class="btn-text btn-text-multiline">
          <span class="text-line-1">More Inclusivity</span>
          <span class="text-line-2">Books</span>
        </span>
      </a>
    </div>

  </div>

  {# More Details Section #}
  <div class="book-more-details">
    <h2 class="section-title">More Details</h2>
    <div class="details-grid">
      
      {# Author #}
      {% if author_label %}
        <a href="{{ author_url }}" class="detail-card detail-card-link">
          <div class="detail-icon">
            <img src="/themes/custom/storyfulls/images/author-icon.png" alt="Author" onerror="this.style.display='none'">
          </div>
          <div class="detail-label">Author</div>
          <div class="detail-value">{{ author_label }}</div>
        </a>
      {% endif %}

      {# Illustrator #}
      {% if illustrator_label %}
        <a href="{{ illustrator_url }}" class="detail-card detail-card-link">
          <div class="detail-icon">
            <img src="/themes/custom/storyfulls/images/illustrator-icon.png" alt="Illustrator" onerror="this.style.display='none'">
          </div>
          <div class="detail-label">Illustrator</div>
          <div class="detail-value">{{ illustrator_label }}</div>
        </a>
      {% endif %}

      {# Age Group #}
      {% if age_group_label %}
        <div class="detail-card">
          <div class="detail-icon">
            <img src="/themes/custom/storyfulls/images/age-group-icono.png" alt="Age" onerror="this.style.display='none'">
          </div>
          <div class="detail-label">Age group</div>
          <div class="detail-value">{{ age_group_label }}</div>
        </div>
      {% endif %}

      {# Genre #}
      {% if genere_label %}
        <div class="detail-card">
          <div class="detail-icon">
            <img src="/themes/custom/storyfulls/images/genre-icon.png" alt="Genre" onerror="this.style.display='none'">
          </div>
          <div class="detail-label">Genre</div>
          <div class="detail-value">{{ genere_label }}</div>
        </div>
      {% endif %}

      {# Publisher #}
      {% if publisher_label %}
        <div class="detail-card">
          <div class="detail-icon">
            <img src="/themes/custom/storyfulls/images/publisher-icon.png" alt="Publisher" onerror="this.style.display='none'">
          </div>
          <div class="detail-label">Publisher</div>
          <div class="detail-value">{{ publisher_label }}</div>
        </div>
      {% endif %}

    </div>
  </div>

  {# Tags Section #}
  {% if tags|length > 0 %}
    <div class="book-tags-section">
      <h2 class="section-title">Tags</h2>
      <div class="tags-list">
        {% for tag in tags %}
          <a href="/taxonomy/term/{{ tag.id }}" class="tag-item">{{ tag.name }}</a>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  {# Reviews Section #}
  <div class="book-reviews-section">
    <div class="reviews-header-wrapper">
      <h2 class="section-title reviews-title">Reviews</h2>
    </div>
    
    <div class="reviews-button-wrapper">
      {# Write Review Button - Always show, but handle differently based on user state #}
      {% if user_is_logged_in and (user_already_reviewed or in_wishlist) %}
        <button class="write-review-btn already-reviewed-btn" 
          data-already-reviewed="{{ user_already_reviewed ? 'true' : 'false' }}"
          data-in-wishlist="{{ in_wishlist ? 'true' : 'false' }}">
          <img src="/themes/custom/storyfulls/images/writeareviewbutton-icon.png" alt="" class="write-review-icon-left">
          <span class="write-review-text">Write a Review</span>
          <img src="/themes/custom/storyfulls/images/writeareviewdesign-icon.png" alt="" class="write-review-icon-right">
        </button>
      {% elseif user_is_logged_in %}
        <a href="{{ write_review_url }}" class="write-review-btn">
          <img src="/themes/custom/storyfulls/images/writeareviewbutton-icon.png" alt="" class="write-review-icon-left">
          <span class="write-review-text">Write a Review</span>
          <img src="/themes/custom/storyfulls/images/writeareviewdesign-icon.png" alt="" class="write-review-icon-right">
        </a>
      {% else %}
        <a href="/user/login?destination={{ current_path }}" class="write-review-btn">
          <img src="/themes/custom/storyfulls/images/writeareviewbutton-icon.png" alt="" class="write-review-icon-left">
          <span class="write-review-text">Write a Review</span>
          <img src="/themes/custom/storyfulls/images/writeareviewdesign-icon.png" alt="" class="write-review-icon-right">
        </a>
      {% endif %}
    </div>
    
    {# Custom success message banner #}
    {% if review_just_submitted %}
      <div class="review-success-message">
        <div class="success-content">
          <strong>Review Submitted!</strong>
          <p>Thank you for sharing your thoughts! Your review will appear below.</p>
        </div>
      </div>
    {% endif %}
    
    {# Reviews list #}
    <div class="reviews-list">
      {% if reviews %}
        {% for review in reviews %}
          <div class="review-card">
            <div class="review-avatar">
              {% if review.author_avatar %}
                <img src="{{ review.author_avatar }}" alt="{{ review.author_name }}">
              {% else %}
                <div class="avatar-placeholder">{{ review.author_name|slice(0, 1)|upper }}</div>
              {% endif %}
            </div>
            
            {% if review.rating %}
              <div class="review-rating">
                <span class="star-icon">â˜…</span>
                <span class="rating-value">{{ review.rating }}.0</span>
              </div>
            {% endif %}
            
            <div class="review-card-content">
              <div class="review-text-wrapper">
                <p class="review-text" data-review-id="{{ review.id }}">{{ review.review_text }}</p>
                <a href="/user/{{ review.author_id }}/reviews" class="review-read-more" style="display: none;">Read more</a>
                <div class="review-author">-{{ review.author_name }}</div>
              </div>
              
              <div class="review-footer">
                <span class="review-date">{{ review.created|format_date('custom', 'j F, Y') }}</span>
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="no-reviews">No reviews yet. Be the first to review this book!</p>
      {% endif %}
    </div>
  </div>

  {# You Might Also Like Section - Will be implemented later with a custom view #}
  {# 
  <div class="book-recommendations-section">
    <h2 class="section-title">You Might Also Like</h2>
    <div class="recommendations-list">
      <p class="no-recommendations">Related books coming soon!</p>
    </div>
  </div>
  #}

</article>
